<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mandiri Cell - Form Pendaftaran</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    /* ... (CSS sama persis seperti sebelumnya, tidak saya potong agar tetap utuh) ... */
  </style>
</head>
<body>

<!-- Header, Form, Footer tetap sama seperti sebelumnya -->

<script>
  const fields = ["namaOutlet", "namaPemilik", "alamatLengkap", "pinTransaksi"];
  const submitBtn = document.getElementById("submitBtn");

  const showModal = (msg) => {
    const modal = document.getElementById("popupModal");
    const text = document.querySelector("#popupText span");
    text.textContent = msg;
    modal.style.display = "flex";
    document.body.style.overflow = "hidden";
  };

  const closeModal = () => {
    document.getElementById("popupModal").style.display = "none";
    document.body.style.overflow = "";
  };

  function validateInput(id, pattern, message) {
    const input = document.getElementById(id);
    input.addEventListener("input", () => {
      const val = input.value;
      const invalidChars = val.match(/[^a-zA-Z0-9\s]/g);

      if (invalidChars) {
        const unik = [...new Set(invalidChars)].join(' ');
        showModal(`Karakter tidak valid ditemukan: ${unik}\n${message}`);
        input.value = val.replace(/[^a-zA-Z0-9\s]/g, '');
      }

      validateForm();
    });
  }

  function validateNoSpace(id, message) {
    const input = document.getElementById(id);
    input.addEventListener("input", () => {
      const val = input.value;
      const invalidChars = val.match(/[^a-zA-Z0-9]/g);

      if (invalidChars) {
        const unik = [...new Set(invalidChars)].join(' ');
        showModal(`Karakter tidak valid ditemukan: ${unik}\n${message}`);
        input.value = val.replace(/[^a-zA-Z0-9]/g, '');
      }

      validateForm();
    });
  }

  function updateIconColor(id) {
    const input = document.getElementById(id);
    const wrapper = input.parentElement;
    input.addEventListener("input", () => {
      if (input.value.trim() !== "") {
        wrapper.classList.add("filled");
      } else {
        wrapper.classList.remove("filled");
      }
    });
  }

  function validateForm() {
    const namaOutlet = document.getElementById("namaOutlet").value.trim();
    const namaPemilik = document.getElementById("namaPemilik").value.trim();
    const alamatLengkap = document.getElementById("alamatLengkap").value.trim();
    const pinTransaksi = document.getElementById("pinTransaksi").value.trim();

    const valid =
      /^[a-zA-Z0-9\s]+$/.test(namaOutlet) &&
      /^[a-zA-Z0-9\s]+$/.test(namaPemilik) &&
      /^[a-zA-Z0-9\s]+$/.test(alamatLengkap) &&
      /^[a-zA-Z0-9]{6,}$/.test(pinTransaksi);

    submitBtn.disabled = !valid;
  }

  ["namaOutlet", "namaPemilik", "alamatLengkap"].forEach(id =>
    validateInput(id, /^[a-zA-Z0-9\s]+$/, "Hanya huruf dan angka yang diperbolehkan.")
  );
  validateNoSpace("pinTransaksi", "PIN hanya boleh huruf dan angka, tanpa spasi.");
  validateNoSpace("referral", "Referral hanya boleh huruf dan angka.");

  ["namaOutlet", "namaPemilik", "alamatLengkap", "pinTransaksi", "referral"].forEach(updateIconColor);

  document.getElementById("formPendaftaran").addEventListener("submit", (e) => {
    e.preventDefault();
    const namaOutlet = document.getElementById("namaOutlet").value.trim();
    const namaPemilik = document.getElementById("namaPemilik").value.trim();
    const alamatLengkap = document.getElementById("alamatLengkap").value.trim();
    const pinTransaksi = document.getElementById("pinTransaksi").value.trim();
    const referral = document.getElementById("referral").value.trim();

    let pesan = `DAFTAR#${namaOutlet}#${namaPemilik}#${alamatLengkap}#${pinTransaksi}`;
    if (referral !== "") {
      pesan += `#${referral}`;
    }

    const wa = `https://wa.me/6282188890720?text=${encodeURIComponent(pesan)}`;
    window.open(wa, "_blank");
  });
</script>

</body>
</html>
